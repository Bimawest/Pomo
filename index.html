<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PB. POMO</title>
    <meta property="og:image" content="https://bimawest.github.io/Pomo/img/pomo.jpg" />
    <meta property="og:url" content="https://bimawest.github.io/Pomo/" />
    <meta property="og:image:alt" content="PB. POMO" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Trade+Winds&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 100%;
            margin: auto;
            background-image: url('img/pomo.jpg');
            background-size: cover;
            background-repeat: no-repeat;
            justify-items: center;
        }

        /* Gaya untuk overlay loading */
        .shuttlecock, .kok {
          position: relative;
          top: 100px;
        }
        
        .kok {
            display: flex;
            flex-direction: columns;
            gap: 50px;
            width: 200px;
            height: 50px;
            margin-bottom: 20px;
        }
        
        .bulu1 {
            background-color: steelblue;
            border: 5px black solid;
            height: 50px;
            width: 50px;
            border-radius: 50%;
            transform: rotate(-35deg);
        }
        
        .bulu2 {
            background-color: steelblue;
            height: 50px;
            width: 50px;
            border-radius: 50%;
            border: 5px black solid;
        }
        
        .bulu3 {
            background-color: steelblue;
            height: 50px;
            width: 50px;
            border-radius: 50%;
            transform: rotate(35deg);
            border: 5px black solid;
        }

        .semitriangle {
            height: 120px;
            width: 100px;
            background-color: steelblue;
            margin-bottom: 5px;
            margin-left: 50px;
            border: 5px black solid;
            clip-path: polygon(0% 0, 100% 0, 75% 100%, 25% 100%);
            display: flex;
            flex-direction: columns;
        }
        
        .line1, .line3 {
            width: 2px;
            height: 70px;
            background-color: black;
            margin-left: 20px;
        }
        
        .line2 {
            width: 2px;
            height: 100px;
            background-color: black;
            margin-left: 20px;
        }
        
        .line4 {
            width: 50px;
            height: 2px;
            background-color: black;
            right: 550px;
        }

        .semicircle {
            width: 60px;
            height: 60px;
            background-color: steelblue;
            border-bottom-left-radius: 100px;
            border-bottom-right-radius: 100px;
            border: 5px black solid;
            margin-left: 70px;
        }

        .anim {
            position: relative;
            height: 50px;
            animation: bounce 2s infinite ease-in-out;
        }

        @keyframes bounce {
            0% {
                top: 0;
            }
            
            50% {
                top: 50px;
            }
            100% {
                top: 0;
            }
        }

        .bayangan {
            position: fixed;
            width: 200px;
            height: 50px;
            background-color: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            top: 400px;
            animation: ukuran 2s infinite ease-in-out;
            z-index: -1;
            margin-left: 80px;
        }
        
        @keyframes ukuran {
            0% {
                scale: 0.3;
            }
            
            50% {
                scale: 1.3;
            }
            100% {
                scale: 0.3;
            }
        }

        #loading-text {
            position: fixed;
            color: white;
            font-size: 1.5rem;
            margin-top: 410px;
            margin-left: 80px;
        }

        /* Gaya untuk konten utama */
        .pomo {
            width: 95%;
            height: 100%;
            background-color: rgb(107, 106, 106);
            backdrop-filter: blur(5px);
            color: white;
            outline: 3px black dashed;
            border-radius: 25px;
            padding: 3px;
            margin-top: 5%;
            
            /* Sembunyikan dan beri animasi */
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.5s ease-in, transform 0.5s ease-in;
        }

        .pomo.show {
            opacity: 1;
            transform: scale(1);
        }

        h1 {
            font-family: "Trade Winds";
            font-style: italic;
        }

        h1, h2 {
            color: white;
            margin: 5px;
            text-shadow: 
                -1px -1px 0 #000,  
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000;
        }

        form {
            margin-bottom: 20px;
            margin: 5px;
        }
        
        #tabel-container {
            max-height: 250px;
            width: 90%;
            overflow-y: scroll;
            border: 1px solid #ddd;
            margin-top: 20px;
            margin: 5px;
        }

        hr {
            width: 80%;
            margin: 5px;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
        }

        #daftar-pendaftar {
            width: 100%;
            border-collapse: collapse;
        }

        #daftar-pendaftar th,
        #daftar-pendaftar td {
            color: #000;
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            text-shadow: 
                -1px -1px 0 #fff,  
                1px -1px 0 #fff,
                -1px 1px 0 #fff,
                1px 1px 0 #fff;
        }

        #daftar-pendaftar td {
            font-family: Comic Sans MS;
            font-size: 1.1rem;
        }

        #daftar-pendaftar th {
            background-color: #333;
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .highlight, .duit {
            font-weight: bold;
            color: #007BFF;
        }
        
        p {
            font-size: 1.1rem;
            color: #000;
            margin: 5px;
            text-shadow: 
                -1px -1px 0 #fff,  
                1px -1px 0 #fff,
                -1px 1px 0 #fff,
                1px 1px 0 #fff;
        }
        
        .delete-btn, #hapus-semua-btn {
            background-color: red;
            color: white;
            border: 1px black solid;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <section id="loading-overlay" class="anim">
        <section class="kok">
            <div class="bulu1"></div>
            <div class="bulu2"></div>
            <div class="bulu3"></div>
        </section>
        <section class="shuttlecock">
            <div class="semitriangle">
                <hr class="line1">
                <hr class="line2">
                <hr class="line3">
            </div>
            <div class="semicircle">
                <hr class="line4">
            </div>
        </section>
    </section>
    <div class="bayangan"></div>
    <div id="loading-text" style="text-shadow: 
                -1px -1px 0 #000,  
                1px -1px 0 #000,
                -1px 1px 0 #000,
                1px 1px 0 #000;">Sedang memuat...</div>
    </div>
  
    <section class="pomo">
        <h1>PB. POMO Kuala</h1>
        <p id="tanggal-main" style="color: white; text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;"></p>

        <form id="form-pendaftaran">
            <input type="text" id="nama-pendaftar" placeholder="Masukkan nama Anda" required>
            <button type="submit">Daftar</button>
        </form>
        
        <button id="hapus-semua-btn">Hapus Semua Pendaftar</button>

        <p id="pesan-status"></p>

        <div id="tabel-container">
            <table id="daftar-pendaftar">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama Pemain</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>

        <hr>

        <h2>Kalkulator Patungan</h2>
        <p>lapangan: <span id="harga-lapangan" class="duit">Rp 100.000</span></p>
        <p>shuttlecock: <span id="harga-shuttlecock" class="duit">Rp 135.000</span></p>
        <p>Total harga: <span id="total-harga" class="highlight">Rp</span></p>
        <p>Jumlah pemain: <span id="jumlah-pendaftar" class="highlight">0</span> orang</p>
        <p>Patungan per orang: <span id="patungan-per-orang" class="highlight">Rp 0</span></p>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const URL_APPS_SCRIPT_ANDA = 'https://script.google.com/macros/s/AKfycby1MFQ1vqjv9XBZrS0u9xG6XEjtxqWNHlojc1F_fBcVpylOsUp2mXdNdvcO32YOXnePcQ/exec';

            const hargaLapangan = 100000;
            const hargaShuttlecock = 135000;
            const totalHarga = hargaLapangan + hargaShuttlecock;
            
            const tampilkanHarga = (elementId, harga) => {
              const element = document.getElementById(elementId);
              if (element) {
                element.textContent = `Rp ${harga.toLocaleString('id-ID')}`;
              }
            };

            tampilkanHarga('total-harga', totalHarga);
            tampilkanHarga('harga-lapangan', hargaLapangan);
            tampilkanHarga('harga-shuttlecock', hargaShuttlecock);

            const hariIni = new Date();
            const hariSaatIni = hariIni.getDay(); // 0 = Minggu, 1 = Senin, ..., 6 = Sabtu
            const hariTarget = 6; // Sabtu

            let hariUntukDitambahkan = hariTarget - hariSaatIni;
            if (hariUntukDitambahkan <= 0) {
              hariUntukDitambahkan += 7; // Jika hari ini sudah Sabtu, tambahkan 7 hari
            }

            const tanggalMain = new Date(hariIni);
            tanggalMain.setDate(hariIni.getDate() + hariUntukDitambahkan);
            
            const opsiFormat = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            const tanggalMainFormat = tanggalMain.toLocaleDateString('id-ID', opsiFormat);
            
            const tanggalMainElement = document.getElementById('tanggal-main');
            if (tanggalMainElement) {
              tanggalMainElement.textContent = `Tanggal main: ${tanggalMainFormat}, jam 8 PM`;
            }

            const tableBody = document.querySelector('#daftar-pendaftar tbody');
            const jumlahPendaftarSpan = document.getElementById('jumlah-pendaftar');
            const patunganPerOrangSpan = document.getElementById('patungan-per-orang');
            const formPendaftaran = document.getElementById('form-pendaftaran');
            const pesanStatus = document.getElementById('pesan-status');
            const hapusSemuaBtn = document.getElementById('hapus-semua-btn');
            
            // --- Logika untuk Loading dan Animasi ---
            const pomoSection = document.querySelector('.pomo');
            const loadingOverlay = document.getElementById('loading-overlay');
            
            function muatDaftarPendaftar() {
                // Tampilkan overlay loading sebelum memuat data
                loadingOverlay.style.display = 'block';
                pomoSection.classList.remove('show');

                fetch(URL_APPS_SCRIPT_ANDA)
                    .then(response => response.json())
                    .then(data => {
                        tableBody.innerHTML = '';
                        if (data && data.length > 0) {
                            data.forEach((pendaftar, index) => {
                                const row = tableBody.insertRow();
                                const noCell = row.insertCell(0);
                                const namaCell = row.insertCell(1);
                                const aksiCell = row.insertCell(2);
                                noCell.textContent = index + 1;
                                namaCell.textContent = pendaftar['Nama'];
                                
                                const deleteButton = document.createElement('button');
                                deleteButton.textContent = 'Hapus';
                                deleteButton.className = 'delete-btn';
                                deleteButton.onclick = () => hapusPendaftar(pendaftar['Nama']);
                                aksiCell.appendChild(deleteButton);
                            });
    
                            const jumlahPendaftar = data.length;
                            const patunganPerOrang = totalHarga / jumlahPendaftar;
    
                            jumlahPendaftarSpan.textContent = jumlahPendaftar;
                            patunganPerOrangSpan.textContent = `Rp ${patunganPerOrang.toLocaleString('id-ID')}`;
                        } else {
                            tableBody.innerHTML = '<tr><td colspan="3">Tidak ada pendaftar.</td></tr>';
                            jumlahPendaftarSpan.textContent = 0;
                            patunganPerOrangSpan.textContent = `Rp 0`;
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        tableBody.innerHTML = '<tr><td colspan="3">Gagal memuat data. Periksa URL Apps Script Anda.</td></tr>';
                    })
                    .finally(() => {
                        // Setelah loading selesai (berhasil atau gagal)
                        // Sembunyikan overlay loading
                        loadingOverlay.style.display = 'none';
                        // Tampilkan konten utama dengan animasi
                        pomoSection.classList.add('show');
                    });
            }

            function hapusPendaftar(nama) {
                if (!confirm(`Apakah Anda yakin ingin menghapus pendaftar "${nama}"?`)) {
                    return;
                }
                pesanStatus.textContent = `Menghapus pendaftar "${nama}"...`;
                
                fetch(URL_APPS_SCRIPT_ANDA + `?action=delete&nama=${encodeURIComponent(nama)}`, {
                    method: 'POST',
                })
                .then(response => response.text())
                .then(result => {
                    pesanStatus.textContent = result;
                    muatDaftarPendaftar();
                })
                .catch(error => {
                    console.error('Error deleting data:', error);
                    pesanStatus.textContent = 'Gagal menghapus pendaftar.';
                });
            }

            function hapusSemuaPendaftar() {
                if (!confirm('Apakah Anda yakin ingin menghapus SEMUA pendaftar?')) {
                    return;
                }
                pesanStatus.textContent = 'Menghapus semua pendaftar...';

                fetch(URL_APPS_SCRIPT_ANDA + `?action=deleteAll`, {
                    method: 'POST',
                })
                .then(response => response.text())
                .then(result => {
                    pesanStatus.textContent = result;
                    muatDaftarPendaftar();
                })
                .catch(error => {
                    console.error('Error deleting all data:', error);
                    pesanStatus.textContent = 'Gagal menghapus semua pendaftar.';
                });
            }

            muatDaftarPendaftar();
            
            formPendaftaran.addEventListener('submit', function(event) {
                event.preventDefault();
                const namaPendaftar = document.getElementById('nama-pendaftar').value;
                pesanStatus.textContent = 'Menambahkan pendaftar...';

                fetch(URL_APPS_SCRIPT_ANDA, {
                    method: 'POST',
                    body: JSON.stringify({ nama: namaPendaftar }),
                })
                .then(response => response.text())
                .then(result => {
                    pesanStatus.textContent = result;
                    document.getElementById('nama-pendaftar').value = '';
                    muatDaftarPendaftar();
                })
                .catch(error => {
                    console.error('Error submitting data:', error);
                    pesanStatus.textContent = 'Gagal menambahkan pendaftar.';
                });
            });

            hapusSemuaBtn.addEventListener('click', hapusSemuaPendaftar);
        });
    </script>
</body>
</html>
